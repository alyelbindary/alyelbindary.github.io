<!-- Citation Modal -->
<div id="citation-modal-{{ include.id }}" class="citation-modal" style="display: none;">
  <div class="citation-modal-content">
    <span class="citation-close" onclick="closeCitationModal('{{ include.id }}')">&times;</span>
    <h2>Cite this publication</h2>
    
    <div class="citation-tabs">
      <button class="citation-tab-button active" onclick="showCitationFormat('{{ include.id }}', 'bibtex')">BibTeX</button>
      <button class="citation-tab-button" onclick="showCitationFormat('{{ include.id }}', 'ris')">RIS</button>
      <button class="citation-tab-button" onclick="showCitationFormat('{{ include.id }}', 'endnote')">EndNote</button>
    </div>
    
    <div id="citation-bibtex-{{ include.id }}" class="citation-format-content active">
      <pre><code>{{ include.bibtex }}</code></pre>
      <button class="copy-button" onclick="copyCitation('{{ include.id }}', 'bibtex')">Copy BibTeX</button>
    </div>
    
    <div id="citation-ris-{{ include.id }}" class="citation-format-content" style="display: none;">
      <pre><code>{{ include.ris }}</code></pre>
      <button class="copy-button" onclick="copyCitation('{{ include.id }}', 'ris')">Copy RIS</button>
    </div>
    
    <div id="citation-endnote-{{ include.id }}" class="citation-format-content" style="display: none;">
      <pre><code>{{ include.endnote }}</code></pre>
      <button class="copy-button" onclick="copyCitation('{{ include.id }}', 'endnote')">Copy EndNote</button>
    </div>
  </div>
</div>

<style>
.citation-modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}

.citation-modal-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border: 1px solid #888;
  border-radius: 8px;
  width: 80%;
  max-width: 700px;
  position: relative;
}

.citation-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  line-height: 20px;
}

.citation-close:hover,
.citation-close:focus {
  color: #000;
}

.citation-tabs {
  display: flex;
  gap: 10px;
  margin: 20px 0;
  border-bottom: 2px solid #ddd;
}

.citation-tab-button {
  background-color: transparent;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  font-size: 16px;
  border-bottom: 3px solid transparent;
  transition: all 0.3s;
}

.citation-tab-button:hover {
  background-color: #f0f0f0;
}

.citation-tab-button.active {
  border-bottom: 3px solid #007bff;
  font-weight: bold;
}

.citation-format-content {
  margin: 20px 0;
}

.citation-format-content pre {
  background-color: #f5f5f5;
  padding: 15px;
  border-radius: 5px;
  overflow-x: auto;
  border: 1px solid #ddd;
}

.citation-format-content code {
  font-family: 'Courier New', monospace;
  font-size: 14px;
}

.copy-button {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  margin-top: 10px;
}

.copy-button:hover {
  background-color: #0056b3;
}

.copy-button.copied {
  background-color: #28a745;
}
</style>

<script>
function openCitationModal(id) {
  document.getElementById('citation-modal-' + id).style.display = 'block';
}

function closeCitationModal(id) {
  document.getElementById('citation-modal-' + id).style.display = 'none';
}

function showCitationFormat(id, format) {
  // Hide all format contents
  var contents = document.querySelectorAll('#citation-modal-' + id + ' .citation-format-content');
  contents.forEach(function(content) {
    content.style.display = 'none';
  });
  
  // Remove active class from all tabs
  var tabs = document.querySelectorAll('#citation-modal-' + id + ' .citation-tab-button');
  tabs.forEach(function(tab) {
    tab.classList.remove('active');
  });
  
  // Show selected format
  document.getElementById('citation-' + format + '-' + id).style.display = 'block';
  
  // Add active class to clicked tab
  event.target.classList.add('active');
}

function copyCitation(id, format) {
  var text = document.querySelector('#citation-' + format + '-' + id + ' code').textContent;
  
  navigator.clipboard.writeText(text).then(function() {
    var button = event.target;
    var originalText = button.textContent;
    button.textContent = 'Copied!';
    button.classList.add('copied');
    
    setTimeout(function() {
      button.textContent = originalText;
      button.classList.remove('copied');
    }, 2000);
  });
}

// Close modal when clicking outside
window.onclick = function(event) {
  if (event.target.classList.contains('citation-modal')) {
    event.target.style.display = 'none';
  }
}
</script>